<div class="session-form" layout="column">
  <div class="session-from-message">
    <div class="session-form-message-tip" translate>
      {{ 'session.'+form.current+'.'+(form.message ? form.message : 'tip_title')}}
    </div>
    <div class="session-form-message-subtip" translate>
      {{"session."+form.current+".tip"}}
    </div>
  </div>

  <form class="session-form" role="form" name="sessionForm" ng-submit="submit()" novalidate> <!-- novalidate prevents HTML5 validation since we will be validating ourselves -->
    <div id="error_alert" class="alert alert-danger" ng-show="error.current !== null">
      {{'session.' + form.current + '.error.' + error.current | translate}}
    </div>

    <md-input-container ng-if="isFieldVisible('nick')" class="md-block">
      <label for=nick>{{ 'session.'+form.current+'.nick' | translate }}</label>
      <input type="text"
             id="nick"
             name="nick"
             ng-model="form.values.nick"
             ng-required="validation.required()"
             ng-pattern="validation.nickPattern()" />
      <div ng-messages="sessionForm.nick.$error" ng-if="sessionForm.nick.$touched">
        <div ng-message="required" translate>session.register.error.nick.required</div>
        <div ng-message="pattern" translate>session.register.error.nick.pattern</div>
      </div>
    </md-input-container>

    <md-input-container ng-if="isFieldVisible('password')" class="md-block">
      <label for=password>{{ 'session.'+form.current+'.password' | translate }}</label>
      <input type="password"
             id="password"
             name="password"
             ng-model="form.values.password"
             ng-required="validation.required()"
             ng-pattern="validation.passwordPattern()" />
      <div ng-messages="sessionForm.password.$error" ng-if="sessionForm.password.$touched">
        <div ng-message="required">{{'session.'+form.current+'.error.password.required' | translate }}</div>
        <div ng-message="pattern" translate>session.register.error.password.pattern</div>
      </div>
      <div class="forgotten-password-link" ng-if="form.current=='login'">
        <a ng-click="goToForm(sessionForm, 'forgottenPassword')" class="session-forgotten-password-form-btn" translate>session.forgottenPassword.link</a>
      </div>
    </md-input-container>

    <md-input-container ng-if="isFieldVisible('passwordRepeat')" class="md-block">
      <label for=passwordRepeat>{{ 'session.'+form.current+'.passwordRepeat' | translate }}</label>
      <input type="password"
             id="passwordRepeat"
             name="passwordRepeat"
             ng-model="form.values.passwordRepeat"
             required
             ng-pattern="validation.passwordPattern()"
             match-validator="form.values.password" />
      <div ng-messages="sessionForm.passwordRepeat.$error" ng-if="sessionForm.passwordRepeat.$touched">
        <div ng-message="required">{{'session.'+form.current+'.error.passwordRepeat.required' | translate }}</div>
        <div ng-message="pattern" translate>session.register.error.password.pattern</div>
        <div ng-message="match" translate>session.register.error.passwordRepeat.match</div>
      </div>
    </md-input-container>

    <md-input-container ng-if="isFieldVisible('email')" class="md-block">
      <label for=email>{{ 'session.'+form.current+'.email' | translate }}</label>
      <input type="email"
             id="email"
             name="email"
             ng-model="form.values.email"
             required />

      <div ng-messages="sessionForm.email.$error" ng-if="sessionForm.email.$touched">
        <div ng-message="required">{{'session.'+form.current+'.error.email.required' | translate }}</div>
        <div ng-message="email">{{'session.'+form.current+'.error.email.email' | translate}}</div>
      </div>
    </md-input-container>

    <md-checkbox ng-if="isFieldVisible('terms')" ng-model="form.values.terms" name="terms" aria-label="terms">
      <span translate>session.register.terms</span>
    </md-checkbox>

    <div layout="column">
      <md-button type="submit" class="md-primary md-raised" flex ng-disabled="sessionForm.$invalid || message.sending">
        <span translate>{{ 'session.' + form.current + '.button' }}</span>
      </md-button>
    </div>

    <div>
      <div class="text-center">
        <p ng-if="form.current=='register'">
          <span translate>session.login.link_prev</span>
          <a ng-click="goToForm(sessionForm, 'login')"  class="text-uppercase" translate>session.login.link</a>
        </p>
        <p ng-if="form.current=='login'">
          <span translate>session.register.link_prev</span>
          <a ng-click="goToForm(sessionForm, 'register')" class="text-uppercase" translate>session.register.link</a>
        </p>
      </div>
    </div>
  </form>
</div>
